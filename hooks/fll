#!/bin/sh

#
# F.U.L.L.S.T.O.R.Y live media initramfs hook
#
# Copyright (C) 2007 F.U.L.L.S.T.O.R.Y Project
#
# F.U.L.L.S.T.O.R.Y Project Homepage:
# http://developer.berlios.de/projects/fullstory
#

set -e

# initramfs-tools prerequisite handling
PREREQS=""

prereqs()
{
	echo "$PREREQ"
}

case "$1" in
	prereqs)
		prereqs
		exit 0
		;;
esac

# source initramfs-tools hook helper functions
. /usr/share/initramfs-tools/hook-functions

# distro-defaults is an absolute requirement
install -D /etc/default/distro ${DESTDIR}/etc/default/distro

# magic filesystem merging module, at least one of these is required
manual_add_modules unionfs
# another filesystem merging module, with a questionable existance
manual_add_modules aufs || true

# squashfs & loop are required
manual_add_modules squashfs
manual_add_modules loop

# initramfs-tools defaults to this, let us make 100% sure
auto_add_modules

# losetup is required
copy_exec /sbin/losetup /sbin
